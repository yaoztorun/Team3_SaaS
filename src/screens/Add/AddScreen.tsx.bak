import React, { useState } from 'react';
import { ScrollView, TouchableOpacity } from 'react-native';
import { Box } from '@/src/components/ui/box';
import { Text } from '@/src/components/ui/text';
import { TopBar } from '@/src/screens/navigation/TopBar';
import { spacing } from '@/src/theme/spacing';
import { Center } from '@/src/components/ui/center';
import { MapPin, Users } from 'lucide-react-native';
import { PrimaryButton } from '@/src/components/PrimaryButton';
import { TextInputField } from '@/src/components/TextInputField';
import { ImageUploadBox } from '@/src/components/ImageUploadBox';
import { RatingStars } from '@/src/components/RatingStars';
import { RadioOption } from '@/src/components/RadioOption';
import { DifficultySelector } from '@/src/components/DifficultySelector';
import { ToggleSwitch } from '@/src/components/ToggleSwitch';

type ViewType = 'log' | 'recipe';

export const AddScreen = () => {
    const [activeView, setActiveView] = useState<ViewType>('log');
    const [rating, setRating] = useState(0);
    const [isAtHome, setIsAtHome] = useState(false);
    const [shareWith, setShareWith] = useState<'private' | 'friends'>('private');
    const [selectedDifficulty, setSelectedDifficulty] = useState<'Easy' | 'Medium' | 'Hard'>('Easy');

    return (
        <Box className="flex-1 bg-neutral-50">
            <TopBar title="Log your drink!" streakCount={7} cocktailCount={42} />
            
            {/* View Toggle */}
            <Box className="px-4 py-2 bg-white border-b border-gray-200">
                <ToggleSwitch
                    value={activeView === 'log' ? 'left' : 'right'}
                    onChange={(val) => setActiveView(val === 'left' ? 'log' : 'recipe')}
                    leftLabel="Log Cocktail"
                    rightLabel="Create Recipe"
                />
            </Box>

            <ScrollView
                className="flex-1"
                contentContainerStyle={{
                    paddingHorizontal: spacing.screenHorizontal,
                    paddingTop: spacing.screenVertical,
                    paddingBottom: spacing.screenBottom,
                }}
            >
                {activeView === 'log' ? (
                    <Box className="flex-1 space-y-6">
                        {/* Cocktail Name */}
                        <Box className="space-y-2">
                            <Text className="text-sm text-neutral-950">Cocktail Name *</Text>
                            <TextInput 
                                className="bg-white p-3 rounded-lg border border-gray-200"
                                placeholder="What cocktail did you drink?"
                            />
                        </Box>

                        {/* Photo Upload */}
                        <Box className="space-y-2">
                            <Text className="text-sm text-neutral-950">Photo</Text>
                            <HStack space="md" className="w-full">
                                <TouchableOpacity 
                                    className="flex-1 h-48 rounded-xl border-2 border-[#00a294] items-center justify-center bg-[#e6faf7]"
                                    activeOpacity={0.7}
                                >
                                    <Box className="items-center space-y-2">
                                        <Box className="p-2">
                                            <Text className="text-4xl">üì∏</Text>
                                        </Box>
                                        <Text className="text-[#00786f] font-medium">Camera</Text>
                                    </Box>
                                </TouchableOpacity>
                                <TouchableOpacity 
                                    className="flex-1 h-48 rounded-xl border-2 border-[#00a294] items-center justify-center bg-[#e6faf7]"
                                    activeOpacity={0.7}
                                >
                                    <Box className="items-center space-y-2">
                                        <Box className="p-2">
                                            <Text className="text-4xl">üñºÔ∏è</Text>
                                        </Box>
                                        <Text className="text-[#00786f] font-medium">Upload Photo</Text>
                                    </Box>
                                </TouchableOpacity>
                            </HStack>
                        </Box>

                        {/* Rating */}
                        <Box className="space-y-2 bg-white p-4 rounded-xl border border-gray-200">
                            <Text className="text-sm text-neutral-950">Rating</Text>
                            <Center>
                                {renderRatingStars()}
                            </Center>
                        </Box>

                        {/* Review */}
                        <Box className="space-y-2">
                            <Text className="text-sm text-neutral-950">Review (Optional)</Text>
                            <TextInput
                                className="bg-white p-3 rounded-lg border border-gray-200 h-16"
                                placeholder="How was your drink? Tell us more!"
                                multiline={true}
                                numberOfLines={3}
                            />
                        </Box>

                        {/* Location */}
                        <Box className="space-y-2">
                            <Text className="text-sm text-neutral-950">Where did you drink it? *</Text>
                            <TextInput
                                className="bg-white p-3 rounded-lg border border-gray-200"
                                placeholder="Bar name, restaurant..."
                            />
                            <TouchableOpacity 
                                className="flex-row items-center space-x-3 bg-white p-4 rounded-xl border border-gray-200"
                                onPress={() => setIsAtHome(!isAtHome)}
                            >
                                <Box className={`w-4 h-4 rounded border items-center justify-center ${isAtHome ? 'bg-primary-500 border-primary-500' : 'border-gray-300'}`}>
                                    {isAtHome && (
                                        <Text className="text-white text-xs">‚úì</Text>
                                    )}
                                </Box>
                                <Text className="text-base">At Home</Text>
                            </TouchableOpacity>
                        </Box>

                        {/* Tag Friends Button */}
                        <TouchableOpacity className="flex-row items-center justify-center space-x-2 bg-gray-100 py-3 rounded-xl border border-gray-200">
                            <Text className="text-base text-gray-600">üë• Tag friends you were drinking with</Text>
                        </TouchableOpacity>

                        {/* Share With */}
                        <Box className="bg-white p-4 rounded-xl border border-gray-200">
                            <Text className="text-sm text-neutral-950 mb-3">Share With</Text>
                            <Box className="space-y-2">
                                <TouchableOpacity 
                                    className="flex-row items-center min-h-[68px] p-3 rounded-lg"
                                    onPress={() => setShareWith('private')}
                                >
                                    <Box className="w-10 h-10 rounded-full bg-[#cbfbf1] items-center justify-center">
                                        <Text className="text-base text-[#00786f]">üë§</Text>
                                    </Box>
                                    <Box className="ml-6 flex-1">
                                        <Text className="text-base text-neutral-900">Just Me</Text>
                                        <Text className="text-sm text-[#6a7282]">Only visible on your profile</Text>
                                    </Box>
                                    <Box className="mr-2">
                                        <Box className={`w-4 h-4 rounded-full border border-[#030213] ${shareWith === 'private' ? 'bg-[#030213]' : 'bg-[#f3f3f5]'}`} />
                                    </Box>
                                </TouchableOpacity>
                                <TouchableOpacity 
                                    className="flex-row items-center min-h-[68px] p-3 rounded-lg"
                                    onPress={() => setShareWith('friends')}
                                >
                                    <Box className="w-10 h-10 rounded-full bg-[#cbfbf1] items-center justify-center">
                                        <Text className="text-base text-[#00786f]">üë•</Text>
                                    </Box>
                                    <Box className="ml-6 flex-1">
                                        <Text className="text-base text-neutral-900">All Friends</Text>
                                        <Text className="text-sm text-[#6a7282]">Share on feed with all friends</Text>
                                    </Box>
                                    <Box className="mr-2">
                                        <Box className={`w-4 h-4 rounded-full border ${shareWith === 'friends' ? 'bg-[#030213] border-[#030213]' : 'bg-[#f3f3f5] border-[rgba(0,0,0,0.1)]'}`} />
                                    </Box>
                                </TouchableOpacity>
                            </Box>
                        </Box>

                        {/* Submit Button */}
                        <TouchableOpacity className="bg-gradient-to-r from-[#009689] to-[#00786f] py-3 rounded-lg">
                            <Text className="text-white text-center">Log Cocktail</Text>
                        </TouchableOpacity>
                    </Box>
                ) : (
                    // Recipe Creation View
                    <Box className="flex-1 space-y-6">
                        {/* Recipe Name */}
                        <Box className="space-y-2">
                            <Text className="text-sm text-neutral-950">Recipe Name *</Text>
                            <TextInput 
                                className="bg-white p-3 rounded-lg border border-gray-200"
                                placeholder="Name your cocktail recipe"
                            />
                        </Box>

                        {/* Recipe Photo */}
                        <Box className="space-y-2">
                            <Text className="text-sm text-neutral-950">Photo</Text>
                            <HStack space="md" className="w-full">
                                <TouchableOpacity 
                                    className="flex-1 h-48 rounded-xl border-2 border-[#00a294] items-center justify-center bg-[#e6faf7]"
                                    activeOpacity={0.7}
                                >
                                    <Box className="items-center space-y-2">
                                        <Box className="p-2">
                                            <Text className="text-4xl">üì∏</Text>
                                        </Box>
                                        <Text className="text-[#00786f] font-medium">Camera</Text>
                                    </Box>
                                </TouchableOpacity>
                                <TouchableOpacity 
                                    className="flex-1 h-48 rounded-xl border-2 border-[#00a294] items-center justify-center bg-[#e6faf7]"
                                    activeOpacity={0.7}
                                >
                                    <Box className="items-center space-y-2">
                                        <Box className="p-2">
                                            <Text className="text-4xl">üñºÔ∏è</Text>
                                        </Box>
                                        <Text className="text-[#00786f] font-medium">Upload Photo</Text>
                                    </Box>
                                </TouchableOpacity>
                            </HStack>
                        </Box>

                        {/* Ingredients */}
                        <Box className="space-y-2">
                            <Text className="text-sm text-neutral-950">Ingredients *</Text>
                            <Box className="bg-white p-4 rounded-xl border border-gray-200 space-y-3">
                                <Box className="space-y-3">
                                    <Box className="flex-col space-y-2">
                                        <TouchableOpacity 
                                            className="w-full p-3 rounded-lg border border-gray-200 bg-white flex-row justify-between items-center"
                                        >
                                            <Text className="text-neutral-600">Select ingredient</Text>
                                            <Text>‚ñº</Text>
                                        </TouchableOpacity>
                                        <Box className="flex-row space-x-2">
                                            <TextInput 
                                                className="flex-1 p-3 rounded-lg border border-gray-200"
                                                placeholder="Amount"
                                                keyboardType="numeric"
                                            />
                                            <TouchableOpacity 
                                                className="flex-1 p-3 rounded-lg border border-gray-200 bg-white flex-row justify-between items-center"
                                            >
                                                <Text className="text-neutral-600">Unit</Text>
                                                <Text>‚ñº</Text>
                                            </TouchableOpacity>
                                        </Box>
                                    </Box>
                                </Box>
                                <TouchableOpacity 
                                    className="flex-row items-center justify-center py-2 mt-2"
                                >
                                    <Text className="text-primary-500">+ Add Ingredient</Text>
                                </TouchableOpacity>
                            </Box>
                        </Box>

                        {/* Instructions */}
                        <Box className="space-y-2">
                            <Text className="text-sm text-neutral-950">Instructions *</Text>
                            <Box className="bg-white p-4 rounded-xl border border-gray-200 space-y-3">
                                <Box className="flex-row items-start space-x-3">
                                    <Text className="text-neutral-400 mt-3">1.</Text>
                                    <TextInput 
                                        className="flex-1 p-2 rounded-lg border border-gray-200"
                                        placeholder="Add step"
                                        multiline={true}
                                        numberOfLines={2}
                                    />
                                </Box>
                                <TouchableOpacity className="flex-row items-center justify-center py-2">
                                    <Text className="text-primary-500">+ Add Step</Text>
                                </TouchableOpacity>
                            </Box>
                        </Box>

                        {/* Difficulty */}
                        <Box className="space-y-2">
                            <Text className="text-sm text-neutral-950">Difficulty</Text>
                            <Box className="bg-white p-4 rounded-xl border border-gray-200">
                                <HStack space="md" className="justify-center">
                                    {['Easy', 'Medium', 'Hard'].map((level) => (
                                        <TouchableOpacity 
                                            key={level}
                                            onPress={() => setSelectedDifficulty(level as 'Easy' | 'Medium' | 'Hard')}
                                            className="items-center px-4"
                                        >
                                            <Box className={`w-12 h-12 rounded-full items-center justify-center mb-2 ${selectedDifficulty === level ? 'bg-[#cbfbf1] border-2 border-[#00786f]' : 'bg-primary-50'}`}>
                                                <Text className="text-xl">
                                                    {level === 'Easy' ? 'ü•Ç' : level === 'Medium' ? 'üç∏' : 'üçπ'}
                                                </Text>
                                            </Box>
                                            <Text className={`text-sm ${selectedDifficulty === level ? 'text-[#00786f] font-bold' : 'text-neutral-600'}`}>
                                                {level}
                                            </Text>
                                        </TouchableOpacity>
                                    ))}
                                </HStack>
                            </Box>
                        </Box>

                        {/* Share With - reusing the same component as Log view */}
                        <Box className="bg-white p-4 rounded-xl border border-gray-200">
                            <Text className="text-sm text-neutral-950 mb-3">Share With</Text>
                            <Box className="space-y-2">
                                <TouchableOpacity 
                                    className="flex-row items-center min-h-[68px] p-3 rounded-lg"
                                    onPress={() => setShareWith('private')}
                                >
                                    <Box className="w-10 h-10 rounded-full bg-[#cbfbf1] items-center justify-center">
                                        <Text className="text-base text-[#00786f]">üë§</Text>
                                    </Box>
                                    <Box className="ml-6 flex-1">
                                        <Text className="text-base text-neutral-900">Just Me</Text>
                                        <Text className="text-sm text-[#6a7282]">Only visible on your profile</Text>
                                    </Box>
                                    <Box className="mr-2">
                                        <Box className={`w-4 h-4 rounded-full border border-[#030213] ${shareWith === 'private' ? 'bg-[#030213]' : 'bg-[#f3f3f5]'}`} />
                                    </Box>
                                </TouchableOpacity>
                                <TouchableOpacity 
                                    className="flex-row items-center min-h-[68px] p-3 rounded-lg"
                                    onPress={() => setShareWith('friends')}
                                >
                                    <Box className="w-10 h-10 rounded-full bg-[#cbfbf1] items-center justify-center">
                                        <Text className="text-base text-[#00786f]">üë•</Text>
                                    </Box>
                                    <Box className="ml-6 flex-1">
                                        <Text className="text-base text-neutral-900">All Friends</Text>
                                        <Text className="text-sm text-[#6a7282]">Share on feed with all friends</Text>
                                    </Box>
                                    <Box className="mr-2">
                                        <Box className={`w-4 h-4 rounded-full border ${shareWith === 'friends' ? 'bg-[#030213] border-[#030213]' : 'bg-[#f3f3f5] border-[rgba(0,0,0,0.1)]'}`} />
                                    </Box>
                                </TouchableOpacity>
                            </Box>
                        </Box>

                        {/* Submit Button */}
                        <TouchableOpacity className="bg-gradient-to-r from-[#009689] to-[#00786f] py-3 rounded-lg">
                            <Text className="text-white text-center">Create Recipe</Text>
                        </TouchableOpacity>
                    </Box>
                )}
            </ScrollView>
        </Box>
    );
};